!function(t,r){"function"==typeof define&&define.amd?define(["jquery"],function(e){return t.Intercooler=r(e)}):"object"==typeof exports?module.exports=r(require("jquery")):t.Intercooler=r(t.jQuery)}(this,function($){var Intercooler=Intercooler||function(){"use strict";function remove(e){e.remove()}function showIndicator(e){0<e.closest(".ic-use-transition").length?(e.data("ic-use-transition",!0),e.removeClass("ic-use-transition")):e.show()}function hideIndicator(e){e.data("ic-use-transition")?(e.data("ic-use-transition",null),e.addClass("ic-use-transition")):e.hide()}function fixICAttributeName(e){return USE_DATA?"data-"+e:e}function getICAttribute(e,t){return e.attr(fixICAttributeName(t))}function setICAttribute(e,t,r){e.attr(fixICAttributeName(t),r)}function prepend(e,t){try{e.prepend(t)}catch(t){log(e,formatError(t),"ERROR")}var r;getICAttribute(e,"ic-limit-children")&&(r=parseInt(getICAttribute(e,"ic-limit-children")),e.children().length>r&&e.children().slice(r,e.children().length).remove())}function append(e,t){try{e.append(t)}catch(t){log(e,formatError(t),"ERROR")}var r;getICAttribute(e,"ic-limit-children")&&(r=parseInt(getICAttribute(e,"ic-limit-children")),e.children().length>r&&e.children().slice(0,e.children().length-r).remove())}function triggerEvent(e,t,r){$.zepto&&(t=t.split(".").reverse().join(":")),e.trigger(t,r)}function log(e,t,r){triggerEvent(e=null==e?$("body"):e,"log.ic",[t,r,e]),"ERROR"==r&&(window.console&&window.console.log("Intercooler Error : "+t),(r=closestAttrValue($("body"),"ic-post-errors-to"))&&$.post(r,{error:t}))}function uuid(){return _UUID++}function icSelectorFor(e){return getICAttributeSelector("ic-id='"+getIntercoolerId(e)+"'")}function parseInterval(e){return log(null,"POLL: Parsing interval string "+e,"DEBUG"),"null"==e||"false"==e||""==e?null:e.lastIndexOf("ms")==e.length-2?parseFloat(e.substr(0,e.length-2)):e.lastIndexOf("s")==e.length-1?1e3*parseFloat(e.substr(0,e.length-1)):1e3}function getICAttributeSelector(e){return"["+fixICAttributeName(e)+"]"}function initScrollHandler(){null==_scrollHandler&&(_scrollHandler=function(){$(getICAttributeSelector("ic-trigger-on='scrolled-into-view'")).each(function(){var e=$(this);isScrolledIntoView(getTriggeredElement(e))&&1!=e.data("ic-scrolled-into-view-loaded")&&(e.data("ic-scrolled-into-view-loaded",!0),fireICRequest(e))})},$(window).scroll(_scrollHandler))}function currentUrl(){return window.location.pathname+window.location.search+window.location.hash}function createDocument(e){var t=null;return/<(html|body)/i.test(e)?(t=document.documentElement.cloneNode()).innerHTML=e:(t=document.documentElement.cloneNode(!0)).querySelector("body").innerHTML=e,$(t)}function getTarget(e){return getTargetImpl(e,"ic-target")}function getTargetImpl(e,t){var r=$(e).closest(getICAttributeSelector(t)),t=getICAttribute(r,t);return"this"==t?r:t&&0!=t.indexOf("this.")?0==t.indexOf("closest ")?e.closest(t.substr(8)):0==t.indexOf("find ")?e.find(t.substr(5)):$(t):e}function processHeaders(elt,xhr){elt=$(elt),triggerEvent(elt,"beforeHeaders.ic",[elt,xhr]),log(elt,"response headers: "+xhr.getAllResponseHeaders(),"DEBUG");var target=null,pathsToRefresh,pollingElt,pollingElt;xhr.getResponseHeader("X-IC-Title")&&(document.title=xhr.getResponseHeader("X-IC-Title")),xhr.getResponseHeader("X-IC-Refresh")&&(pathsToRefresh=xhr.getResponseHeader("X-IC-Refresh").split(","),log(elt,"X-IC-Refresh: refreshing "+pathsToRefresh,"DEBUG"),$.each(pathsToRefresh,function(e,t){refreshDependencies(t.replace(/ /g,""),elt)})),xhr.getResponseHeader("X-IC-Script")&&(log(elt,"X-IC-Script: evaling "+xhr.getResponseHeader("X-IC-Script"),"DEBUG"),eval(xhr.getResponseHeader("X-IC-Script"))),xhr.getResponseHeader("X-IC-Redirect")&&(log(elt,"X-IC-Redirect: redirecting to "+xhr.getResponseHeader("X-IC-Redirect"),"DEBUG"),window.location=xhr.getResponseHeader("X-IC-Redirect")),"true"==xhr.getResponseHeader("X-IC-CancelPolling")&&cancelPolling(elt.closest(getICAttributeSelector("ic-poll"))),"true"==xhr.getResponseHeader("X-IC-ResumePolling")&&(pollingElt=elt.closest(getICAttributeSelector("ic-poll")),setICAttribute(pollingElt,"ic-pause-polling",null),startPolling(pollingElt)),xhr.getResponseHeader("X-IC-SetPollInterval")&&(pollingElt=elt.closest(getICAttributeSelector("ic-poll")),cancelPolling(pollingElt),setICAttribute(pollingElt,"ic-poll",xhr.getResponseHeader("X-IC-SetPollInterval")),startPolling(pollingElt)),xhr.getResponseHeader("X-IC-Open")&&(log(elt,"X-IC-Open: opening "+xhr.getResponseHeader("X-IC-Open"),"DEBUG"),window.open(xhr.getResponseHeader("X-IC-Open")));var triggerValue=xhr.getResponseHeader("X-IC-Trigger"),triggerArgs;triggerValue&&(log(elt,"X-IC-Trigger: found trigger "+triggerValue,"DEBUG"),target=getTarget(elt),xhr.getResponseHeader("X-IC-Trigger-Data")?(triggerArgs=$.parseJSON(xhr.getResponseHeader("X-IC-Trigger-Data")),triggerEvent(target,triggerValue,triggerArgs)):0<=triggerValue.indexOf("{")?$.each($.parseJSON(triggerValue),function(e,t){triggerEvent(target,e,t)}):triggerEvent(target,triggerValue,[]));var localVars=xhr.getResponseHeader("X-IC-Set-Local-Vars"),removeVal,removeValAsInterval;return localVars&&$.each($.parseJSON(localVars),function(e,t){localStorage.setItem(e,t)}),xhr.getResponseHeader("X-IC-Remove")&&elt&&(removeVal=xhr.getResponseHeader("X-IC-Remove"),removeVal+="",removeValAsInterval=parseInterval(removeVal),log(elt,"X-IC-Remove header found.","DEBUG"),target=getTarget(elt),"true"==removeVal||null==removeValAsInterval?remove(target):(target.addClass("ic-removing"),setTimeout(function(){remove(target)},removeValAsInterval))),triggerEvent(elt,"afterHeaders.ic",[elt,xhr]),!0}function beforeRequest(e){e.addClass("disabled"),e.data("ic-request-in-flight",!0)}function requestCleanup(e,t){0<e.length&&hideIndicator(e),t.removeClass("disabled"),t.data("ic-request-in-flight",!1),t.data("ic-next-request")&&(t.data("ic-next-request").req(),t.data("ic-next-request",null))}function replaceOrAddMethod(e,t){if("string"!==$.type(e))return e.append("_method",t),e;var r=/(&|^)_method=[^&]*/,t="&_method="+t;return r.test(e)?e.replace(r,t):e+t}function globalEval(e){return window.eval.call(window,e)}function closestAttrValue(e,t){e=$(e).closest(getICAttributeSelector(t));return 0<e.length?getICAttribute(e,t):null}function formatError(e){var t=e.toString()+"\n";try{t+=e.stack}catch(e){}return t}function handleRemoteRequest(s,n,i,o,c){beforeRequest(s),o=replaceOrAddMethod(o,n);var a=findIndicator(s);0<a.length&&showIndicator(a);var l=uuid(),u=new Date,e={type:USE_ACTUAL_HTTP_METHOD?n:"GET"==n?"GET":"POST",url:i,data:o,dataType:"text",headers:{Accept:"text/html-partial, */*; q=0.9","X-IC-Request":!0,"X-HTTP-Method-Override":n},beforeSend:function(e,t){triggerEvent(s,"beforeSend.ic",[s,o,t,e,l]),log(s,"before AJAX request "+l+": "+n+" to "+i,"DEBUG");var r=closestAttrValue(s,"ic-on-beforeSend");r&&globalEval("(function (data, settings, xhr) {"+r+"})")(o,t,e)},success:function(e,t,r){triggerEvent(s,"success.ic",[s,e,t,r,l]),log(s,"AJAX request "+l+" was successful.","DEBUG");var n=closestAttrValue(s,"ic-on-success");if(!n||0!=globalEval("(function (data, textStatus, xhr) {"+n+"})")(e,t,r)){n=new Date;try{if(processHeaders(s,r)){log(s,"Processed headers for request "+l+" in "+(new Date-n)+"ms","DEBUG");var i=new Date;if(r.getResponseHeader("X-IC-PushURL")||"true"==closestAttrValue(s,"ic-push-url"))try{requestCleanup(a,s);var o=r.getResponseHeader("X-IC-PushURL")||closestAttrValue(s,"ic-src");if(!_history)throw"History support not enabled";_history.snapshotForHistory(o)}catch(e){log(s,"Error during history snapshot for "+l+": "+formatError(e),"ERROR")}c(e,t,s,r),log(s,"Process content for request "+l+" in "+(new Date-i)+"ms","DEBUG")}triggerEvent(s,"after.success.ic",[s,e,t,r,l])}catch(e){log(s,"Error processing successful request "+l+" : "+formatError(e),"ERROR")}}},error:function(e,t,r){triggerEvent(s,"error.ic",[s,t,r,e]);var n=closestAttrValue(s,"ic-on-error");n&&globalEval("(function (status, str, xhr) {"+n+"})")(t,r,e),processHeaders(s,e),log(s,"AJAX request "+l+" to "+i+" experienced an error: "+r,"ERROR")},complete:function(e,t){log(s,"AJAX request "+l+" completed in "+(new Date-u)+"ms","DEBUG"),requestCleanup(a,s);try{$.contains(document,s[0])?triggerEvent(s,"complete.ic",[s,o,t,e,l]):triggerEvent($("body"),"complete.ic",[s,o,t,e,l])}catch(e){log(s,"Error during complete.ic event for "+l+" : "+formatError(e),"ERROR")}var r=closestAttrValue(s,"ic-on-complete");r&&globalEval("(function (xhr, status) {"+r+"})")(e,t)}};"string"!=$.type(o)&&(e.dataType=null,e.processData=!1,e.contentType=!1),triggerEvent($(document),"beforeAjaxSend.ic",[e,s]),e.cancel?requestCleanup(a,s):$.ajax(e)}function findIndicator(e){var t,r=null;return getICAttribute(e=$(e),"ic-indicator")?r=$(getICAttribute(e,"ic-indicator")).first():0==(r=e.find(".ic-indicator").first()).length&&((t=closestAttrValue(e,"ic-indicator"))?r=$(t).first():e.next().is(".ic-indicator")&&(r=e.next())),r}function processIncludes(r,e){var t;return 0==$.trim(e).indexOf("{")?(t=$.parseJSON(e),$.each(t,function(e,t){r=appendData(r,e,t)})):$(e).each(function(){var e=$(this).serializeArray();$.each(e,function(e,t){r=appendData(r,t.name,t.value)})}),r}function processLocalVars(r,e){return $(e.split(",")).each(function(){var e=$.trim(this),t=localStorage.getItem(e);t&&(r=appendData(r,e,t))}),r}function appendData(e,t,r){return"string"===$.type(e)?("string"!==$.type(r)&&(r=JSON.stringify(r)),e+"&"+t+"="+encodeURIComponent(r)):(e.append(t,r),e)}function getParametersForElement(e,t,r){var n=getTarget(t),i=null;t.is("form")&&"multipart/form-data"==t.attr("enctype")?i=appendData(i=new FormData(t[0]),"ic-request",!0):(i="ic-request=true",o=t.closest("form"),t.is("form")||"GET"!=e&&0<o.length?(i+="&"+o.serialize(),0<(s=o.find("button:focus").first()).length&&s.attr("name")&&(i=appendData(i,s.attr("name"),s.attr("value")))):i+="&"+t.serialize());var o=closestAttrValue(t,"ic-prompt");if(o){var s=prompt(o);if(!s)return null;o=closestAttrValue(t,"ic-prompt-name")||"ic-prompt-value";i=appendData(i,o,s)}t.attr("id")&&(i=appendData(i,"ic-element-id",t.attr("id"))),t.attr("name")&&(i=appendData(i,"ic-element-name",t.attr("name"))),getICAttribute(n,"ic-id")&&(i=appendData(i,"ic-id",getICAttribute(n,"ic-id"))),n.attr("id")&&(i=appendData(i,"ic-target-id",n.attr("id"))),r&&r.attr("id")&&(i=appendData(i,"ic-trigger-id",r.attr("id"))),r&&r.attr("name")&&(i=appendData(i,"ic-trigger-name",r.attr("name")));r=closestAttrValue(t,"ic-include");r&&(i=processIncludes(i,r));r=closestAttrValue(t,"ic-local-vars");return r&&(i=processLocalVars(i,r)),$(getICAttributeSelector("ic-global-include")).each(function(){i=processIncludes(i,getICAttribute($(this),"ic-global-include"))}),log(t,"request parameters "+(i=appendData(i,"ic-current-url",currentUrl())),"DEBUG"),i}function maybeSetIntercoolerInfo(e){getIntercoolerId(getTarget(e)),1!=e.data("elementAdded.ic")&&(e.data("elementAdded.ic",!0),triggerEvent(e,"elementAdded.ic"))}function getIntercoolerId(e){return getICAttribute(e,"ic-id")||setICAttribute(e,"ic-id",uuid()),getICAttribute(e,"ic-id")}function processNodes(e){1<(e=$(e)).length?e.each(function(){processNodes(this)}):(processMacros(e),processSources(e),processPolling(e),processEventSources(e),processTriggerOn(e),processRemoveAfter(e),processAddClasses(e),processRemoveClasses(e))}function fireReadyStuff(r){triggerEvent(r,"nodesProcessed.ic"),$.each(_readyHandlers,function(e,t){try{t(r)}catch(e){log(r,formatError(e),"ERROR")}})}function autoFocus(e){e.find("[autofocus]").last().focus()}function processMacros(r){$.each(_MACROS,function(e,t){0==r.closest(".ic-ignore").length&&(r.is("["+t+"]")&&processMacro(t,r),r.find("["+t+"]").each(function(){var e=$(this);0==e.closest(".ic-ignore").length&&processMacro(t,e)}))})}function processSources(e){0==e.closest(".ic-ignore").length&&(e.is(getICAttributeSelector("ic-src"))&&maybeSetIntercoolerInfo(e),e.find(getICAttributeSelector("ic-src")).each(function(){var e=$(this);0==e.closest(".ic-ignore").length&&maybeSetIntercoolerInfo(e)}))}function processPolling(e){0==e.closest(".ic-ignore").length&&(e.is(getICAttributeSelector("ic-poll"))&&(maybeSetIntercoolerInfo(e),startPolling(e)),e.find(getICAttributeSelector("ic-poll")).each(function(){var e=$(this);0==e.closest(".ic-ignore").length&&(maybeSetIntercoolerInfo(e),startPolling(e))}))}function processTriggerOn(e){0==e.closest(".ic-ignore").length&&(handleTriggerOn(e),e.find(getICAttributeSelector("ic-trigger-on")).each(function(){var e=$(this);0==e.closest(".ic-ignore").length&&handleTriggerOn(e)}))}function processRemoveAfter(e){0==e.closest(".ic-ignore").length&&(handleRemoveAfter(e),e.find(getICAttributeSelector("ic-remove-after")).each(function(){var e=$(this);0==e.closest(".ic-ignore").length&&handleRemoveAfter(e)}))}function processAddClasses(e){0==e.closest(".ic-ignore").length&&(handleAddClasses(e),e.find(getICAttributeSelector("ic-add-class")).each(function(){var e=$(this);0==e.closest(".ic-ignore").length&&handleAddClasses(e)}))}function processRemoveClasses(e){0==e.closest(".ic-ignore").length&&(handleRemoveClasses(e),e.find(getICAttributeSelector("ic-remove-class")).each(function(){var e=$(this);0==e.closest(".ic-ignore").length&&handleRemoveClasses(e)}))}function processEventSources(e){0==e.closest(".ic-ignore").length&&(handleEventSource(e),e.find(getICAttributeSelector("ic-sse-src")).each(function(){var e=$(this);0==e.closest(".ic-ignore").length&&handleEventSource(e)}))}function startPolling(t){var e,r,n,i,o;null!=t.data("ic-poll-interval-id")||"true"==getICAttribute(t,"ic-pause-polling")||null!=(e=parseInterval(getICAttribute(t,"ic-poll")))&&(r=icSelectorFor(t),n=parseInt(getICAttribute(t,"ic-poll-repeats"))||-1,i=0,log(t,"POLL: Starting poll for element "+r,"DEBUG"),o=setInterval(function(){var e=$(r);triggerEvent(t,"onPoll.ic",e),0==e.length||i==n||t.data("ic-poll-interval-id")!=o?(log(t,"POLL: Clearing poll for element "+r,"DEBUG"),clearTimeout(o)):fireICRequest(e),i++},e),t.data("ic-poll-interval-id",o))}function cancelPolling(e){null!=e.data("ic-poll-interval-id")&&(clearTimeout(e.data("ic-poll-interval-id")),e.data("ic-poll-interval-id",null))}function refreshDependencies(r,n){log(n,"refreshing dependencies for path "+r,"DEBUG"),$(getICAttributeSelector("ic-src")).each(function(){var e=!1,t=$(this);"GET"==verbFor(t)&&"ignore"!=getICAttribute(t,"ic-deps")&&(isDependent(r,getICAttribute(t,"ic-src"))||isDependent(r,getICAttribute(t,"ic-deps"))||"*"==getICAttribute(t,"ic-deps"))&&(null!=n&&$(n)[0]==t[0]||(fireICRequest(t),e=!0)),e&&log(t,"depends on path "+r+", refreshing...","DEBUG")})}function isDependent(e,t){return!!_isDependentFunction(e,t)}function verbFor(e){return getICAttribute(e=$(e),"ic-verb")?getICAttribute(e,"ic-verb").toUpperCase():"GET"}function eventFor(e,t){return"default"==e?(t=$(t)).is("button")?"click":t.is("form")?"submit":t.is("input, textarea, select, button")?"change":"click":e}function preventDefault(e,t){return e.is("form")||e.is('input[type="submit"], button')&&1==e.closest("form").length||e.is("a")&&e.is("[href]")&&0!=e.attr("href").indexOf("#")}function handleRemoveAfter(e){var t;getICAttribute(e=$(e),"ic-remove-after")&&(t=parseInterval(getICAttribute(e,"ic-remove-after")),setTimeout(function(){remove(e)},t))}function parseAndApplyClass(e,t,r){var n,i="",o=50;0<e.indexOf(":")?(n=e.split(":"),i=n[0],o=parseInterval(n[1])):i=e,setTimeout(function(){t[r](i)},o)}function handleAddClasses(e){if(getICAttribute(e=$(e),"ic-add-class"))for(var t=getICAttribute(e,"ic-add-class").split(","),r=t.length,n=0;n<r;n++)parseAndApplyClass($.trim(t[n]),e,"addClass")}function handleRemoveClasses(e){if(getICAttribute(e=$(e),"ic-remove-class"))for(var t=getICAttribute(e,"ic-remove-class").split(","),r=t.length,n=0;n<r;n++)parseAndApplyClass($.trim(t[n]),e,"removeClass")}function handleEventSource(e){var t;getICAttribute(e=$(e),"ic-sse-src")&&(t=initEventSource(e,getICAttribute(e,"ic-sse-src")),e.data("ic-event-sse-source",t),e.data("ic-event-sse-map",{}))}function initEventSource(t,e){e=Intercooler._internal.initEventSource(e);return e.onmessage=function(e){processICResponse(e.data,t,!1)},e}function registerSSE(e,t){var r=e.data("ic-event-sse-source"),n=e.data("ic-event-sse-map");r.addEventListener&&1!=n[t]&&r.addEventListener(t,function(){e.find(getICAttributeSelector("ic-trigger-on")).each(function(){var e=$(this);e.attr("ic-trigger-on")=="sse:"+t&&fireICRequest(e)})})}function getTriggeredElement(elt){var triggerFrom=getICAttribute(elt,"ic-trigger-from");return triggerFrom?$(0<=$.inArray(triggerFrom,["document","window"])?eval(triggerFrom):triggerFrom):elt}function handleTriggerOn(n){var i,e;getICAttribute(n,"ic-trigger-on")&&("load"==getICAttribute(n,"ic-trigger-on")?fireICRequest(n):"scrolled-into-view"==getICAttribute(n,"ic-trigger-on")?(initScrollHandler(),setTimeout(function(){triggerEvent($(window),"scroll")},100)):0==(i=getICAttribute(n,"ic-trigger-on").split(" "))[0].indexOf("sse:")?(e=n.closest(getICAttributeSelector("ic-sse-src")))&&registerSSE(e,i[0].substr(4)):$(getTriggeredElement(n)).on(eventFor(i[0],n),function(e){var t,r=closestAttrValue(n,"ic-on-beforeTrigger");return r&&0==globalEval("(function (evt, elt) {"+r+"})")(e,n)?(log(n,"ic-trigger cancelled by ic-on-beforeTrigger","DEBUG"),!1):("changed"==i[1]?(t=n.val(),r=n.data("ic-previous-val"),n.data("ic-previous-val",t),t!=r&&fireICRequest(n)):fireICRequest(n),!preventDefault(n,e)||(e.preventDefault(),!1))}))}function macroIs(e,t){return e==fixICAttributeName(t)}function processMacro(e,t){macroIs(e,"ic-post-to")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-post-to")),setIfAbsent(t,"ic-verb","POST"),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-put-to")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-put-to")),setIfAbsent(t,"ic-verb","PUT"),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-patch-to")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-patch-to")),setIfAbsent(t,"ic-verb","PATCH"),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-get-from")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-get-from")),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-delete-from")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-delete-from")),setIfAbsent(t,"ic-verb","DELETE"),setIfAbsent(t,"ic-trigger-on","default"),setIfAbsent(t,"ic-deps","ignore")),macroIs(e,"ic-action")&&setIfAbsent(t,"ic-trigger-on","default");var r,n=null;macroIs(e,"ic-style-src")&&(r=(n=getICAttribute(t,"ic-style-src").split(":"))[0],setIfAbsent(t,"ic-src",n[1]),setIfAbsent(t,"ic-target","this.style."+r)),macroIs(e,"ic-attr-src")&&(r=(n=getICAttribute(t,"ic-attr-src").split(":"))[0],setIfAbsent(t,"ic-src",n[1]),setIfAbsent(t,"ic-target","this."+r)),macroIs(e,"ic-prepend-from")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-prepend-from")),setIfAbsent(t,"ic-swap-style","prepend")),macroIs(e,"ic-append-from")&&(setIfAbsent(t,"ic-src",getICAttribute(t,"ic-append-from")),setIfAbsent(t,"ic-swap-style","append"))}function setIfAbsent(e,t,r){null==getICAttribute(e,t)&&setICAttribute(e,t,r)}function isScrolledIntoView(e){if(0!=(e=$(e)).height()||0!=e.width()){var t=$(window).scrollTop(),r=t+$(window).height(),n=e.offset().top,e=n+e.height();return t<=e&&n<=r&&e<=r&&t<=n}}function maybeScrollToTarget(e,t){var r,n;"false"==closestAttrValue(e,"ic-scroll-to-target")||"true"!=closestAttrValue(e,"ic-scroll-to-target")&&"true"!=closestAttrValue(t,"ic-scroll-to-target")||(r=-50,closestAttrValue(e,"ic-scroll-offset")?r=parseInt(closestAttrValue(e,"ic-scroll-offset")):closestAttrValue(t,"ic-scroll-offset")&&(r=parseInt(closestAttrValue(t,"ic-scroll-offset"))),n=t.offset().top,t=(e=$(window).scrollTop())+window.innerHeight,(n<e||t<n)&&(r+=n,$("html,body").animate({scrollTop:r},400)))}function getTransitionDuration(e,t){var r=closestAttrValue(e,"ic-transition-duration");if(r)return parseInterval(r);if(r=closestAttrValue(t,"ic-transition-duration"))return parseInterval(r);e=0,r=(t=$(t)).css("transition-duration");r&&(e+=parseInterval(r));t=t.css("transition-delay");return t&&(e+=parseInterval(t)),e}function closeSSESource(e){var t=e.data("ic-event-sse-source");try{t&&t.close()}catch(t){log(e,"Error closing ServerSentEvent source"+t,"ERROR")}}function beforeSwapCleanup(e){e.find(getICAttributeSelector("ic-sse-src")).each(function(){closeSSESource($(this))}),triggerEvent(e,"beforeSwap.ic")}function processICResponse(e,t,r){if(e&&""!=e&&" "!=e){log(t,"response content: \n"+e,"DEBUG");var n=getTarget(t),i=maybeFilter(e,closestAttrValue(t,"ic-select-from-response"));if(0==n.length)return log(t,"Invalid target for element: "+getICAttribute(t.closest(getICAttributeSelector("ic-target")),"ic-target"),"ERROR"),0;e=getTransitionDuration(t,n);n.addClass("ic-transitioning"),setTimeout(function(){try{!function(){if("true"==closestAttrValue(t,"ic-replace-target")){try{beforeSwapCleanup(n),closeSSESource(n),n.replaceWith(i)}catch(e){log(t,formatError(e),"ERROR")}processNodes(i),fireReadyStuff(n),autoFocus(n)}else{if("prepend"==getICAttribute(t,"ic-swap-style"))prepend(n,i),processNodes(i),fireReadyStuff(n),autoFocus(n);else if("append"==getICAttribute(t,"ic-swap-style"))append(n,i),processNodes(i),fireReadyStuff(n),autoFocus(n);else{try{beforeSwapCleanup(n),n.empty().append(i)}catch(e){log(t,formatError(e),"ERROR")}n.children().each(function(){processNodes(this)}),fireReadyStuff(n),autoFocus(n)}1!=r&&maybeScrollToTarget(t,n)}}()}catch(e){log(t,"Error during content swaop : "+formatError(e),"ERROR")}setTimeout(function(){try{n.removeClass("ic-transitioning"),_history&&_history.updateHistory(),triggerEvent(n,"complete_transition.ic",[n])}catch(e){log(t,"Error during transition complete : "+formatError(e),"ERROR")}},20)},e)}else log(t,"Empty response, nothing to do here.","DEBUG")}function maybeFilter(e,t){var r;return e=$.zepto?(r=createDocument(e),$(r).find("body").contents()):$($.parseHTML(e,null,!0)),t?e.filter(t).add(e.find(t)).contents():e}function getStyleTarget(e){e=closestAttrValue(e,"ic-target");return e&&0==e.indexOf("this.style.")?e.substr(11):null}function getAttrTarget(e){e=closestAttrValue(e,"ic-target");return e&&0==e.indexOf("this.")?e.substr(5):null}function fireICRequest(s,c){var a,l,u=s=$(s),e=closestAttrValue(s=!s.is(getICAttributeSelector("ic-src"))&&null==getICAttribute(s,"ic-action")?s.closest(getICAttributeSelector("ic-src")):s,"ic-confirm");(!e||confirm(e))&&0<s.length&&(a=uuid(),s.data("ic-event-id",a),l=function(){var t,r,n,e,i,o;1!=s.data("ic-request-in-flight")?s.data("ic-event-id")==a&&(t=getStyleTarget(s),r=t?null:getAttrTarget(s),n=verbFor(s),(e=getICAttribute(s,"ic-src"))&&(o=c||function(e){t?s.css(t,e):r?s.attr(r,e):(processICResponse(e,s),"GET"!=n&&refreshDependencies(getICAttribute(s,"ic-src"),s))},(i=getParametersForElement(n,s,u))&&handleRemoteRequest(s,n,e,i,o)),(o=getICAttribute(s,"ic-action"))&&invokeLocalAction(s,o)):s.data("ic-next-request",{req:l})},(e=closestAttrValue(s,"ic-trigger-delay"))?setTimeout(l,parseInterval(e)):l())}function invokeLocalAction(e,t){var r=closestAttrValue(e,"ic-action-target"),i=r?getTargetImpl(e,"ic-action-target"):getTarget(e),t=t.split(";"),o=[],s=0;$.each(t,function(e,t){var r=$.trim(t),n=r,t=[];0<r.indexOf(":")&&(n=r.substr(0,r.indexOf(":")),t=computeArgs(r.substr(r.indexOf(":")+1,r.length))),""==n||("delay"==n?(null==s&&(s=0),s+=parseInterval(t[0]+"")):(null==s&&(s=420),o.push([s,makeApplyAction(i,n,t)]),s=null))}),s=0,$.each(o,function(e,t){s+=t[0],setTimeout(t[1],s)})}function computeArgs(args){try{return eval("["+args+"]")}catch(a){return[$.trim(args)]}}function makeApplyAction(t,r,n){return function(){var e=t[r]||window[r];e?e.apply(t,n):log(t,"Action "+r+" was not found","ERROR")}}function newIntercoolerHistory(s,i,n,o){function c(){for(var e=[],t=0;t<s.length;t++)0==s.key(t).indexOf(d)&&e.push(s.key(t));for(var r=0;r<e.length;r++)s.removeItem(e[r]);s.removeItem(g),f={slotLimit:n,historyVersion:o,lruList:[]}}function a(e){var t=f.lruList,r=t.indexOf(e),n=u($("body"));return 0<=r?(log(n,"URL found in LRU list, moving to end","INFO"),t.splice(r,1),t.push(e)):(log(n,"URL not found in LRU list, adding","INFO"),t.push(e),t.length>f.slotLimit&&(log(n,"History overflow, removing local history for "+(n=t.shift()),"INFO"),s.removeItem(d+n))),s.setItem(g,JSON.stringify(f)),t}function l(e,t,r){t={url:r,id:d+r,content:e,yOffset:t,timestamp:(new Date).getTime()};return a(r),function(t){var r=JSON.stringify(t);try{s.setItem(t.id,r)}catch(e){try{c(),s.setItem(t.id,r)}catch(e){log(u($("body")),"Unable to save intercooler history with entire history cleared, is something else eating local storage? History Limit:"+n,"ERROR")}}}(t),t}function e(e){var t;null!=e.onpopstate&&1==e.onpopstate["ic-on-pop-state-handler"]||(t=e.onpopstate,e.onpopstate=function(e){triggerEvent(u($("body")),"handle.onpopstate.ic"),function(e){e=e.state;if(e&&e["ic-id"]){e=JSON.parse(s.getItem(e["ic-id"]));if(e)return processICResponse(e.content,u($("body")),!0),e.yOffset&&window.scrollTo(0,e.yOffset),!0;$.get(currentUrl(),{"ic-restore-history":!0},function(e,t){processICResponse(u(createDocument(e)).html(),u($("body")),!0)})}return!1}(e)||t&&t(e),triggerEvent(u($("body")),"pageLoad.ic")},e.onpopstate["ic-on-pop-state-handler"]=!0)}function u(e){var t=e.find(getICAttributeSelector("ic-history-elt"));return 0<t.length?t:e}var t,g="ic-history-support",d="ic-hist-elt-",f=JSON.parse(s.getItem(g)),r=null;return null!=(t=f)&&t.slotLimit==n&&t.historyVersion==o&&null!=t.lruList||(log(u($("body")),"Intercooler History configuration changed, clearing history","INFO"),c()),null==f&&(f={slotLimit:n,historyVersion:o,lruList:[]}),{clearHistory:c,updateHistory:function(){r&&(function(e,t,r,n){n=l(r,n,t);i.replaceState({"ic-id":n.id},"","");t=u($("body")),n=l(t.html(),window.pageYOffset,e);i.pushState({"ic-id":n.id},"",e),triggerEvent(t,"pushUrl.ic",[t,n])}(r.newUrl,currentUrl(),r.oldHtml,r.yOffset),r=null)},addPopStateHandler:e,snapshotForHistory:function(e){var t=u($("body"));triggerEvent(t,"beforeHistorySnapshot.ic",[t]),r={newUrl:e,oldHtml:t.html(),yOffset:window.pageYOffset}},_internal:{addPopStateHandler:e,supportData:function(){return f},dumpLocalStorage:function(){var e,t="",r=[];for(e in s)r.push(e);r.sort();var n,i=0;for(n in r){var o=2*s[r[n]].length;i+=o,t+=r[n]+"="+(o/1024/1024).toFixed(2)+" MB\n"}return t+"\nTOTAL LOCAL STORAGE: "+(i/1024/1024).toFixed(2)+" MB"},updateLRUList:a}}}function getSlotLimit(){return 20}function refresh(e){return("string"==typeof e||e instanceof String?refreshDependencies:fireICRequest)(e),Intercooler}function init(){var e=$("body");processNodes(e),fireReadyStuff(e),_history&&_history.addPopStateHandler(window),$.zepto&&($("body").data("zeptoDataTest",{}),"string"==typeof $("body").data("zeptoDataTest")&&console.log("!!!! Please include the data module with Zepto!  Intercooler requires full data support to function !!!!")),location.search&&0<=location.search.indexOf("ic-launch-debugger=true")&&Intercooler.debug()}null==$&&($=Zepto);var USE_DATA="true"==$('meta[name="intercoolerjs:use-data-prefix"]').attr("content"),USE_ACTUAL_HTTP_METHOD="true"==$('meta[name="intercoolerjs:use-actual-http-method"]').attr("content"),_MACROS=$.map(["ic-get-from","ic-post-to","ic-put-to","ic-patch-to","ic-delete-from","ic-style-src","ic-attr-src","ic-prepend-from","ic-append-from","ic-action"],function(e){return fixICAttributeName(e)}),_scrollHandler=null,_UUID=1,_readyHandlers=[],_isDependentFunction=function(e,t){if(!e||!t)return!1;e=e.split(/[\?#]/,1)[0].split("/").filter(function(e){return""!=e}),t=t.split(/[\?#]/,1)[0].split("/").filter(function(e){return""!=e});return""!=e&&""!=t&&(t.slice(0,e.length).join("/")==e.join("/")||e.slice(0,t.length).join("/")==t.join("/"))},_history=null;try{_history=newIntercoolerHistory(localStorage,window.history,getSlotLimit(),.1)}catch(a){log($("body"),"Could not initialize history","WARN")}return $.ajaxTransport&&$.ajaxTransport("text",function(e,t){if("#"!=t.url[0])return null;var i=fixICAttributeName("ic-local-"),t=$(t.url),o=[],s=200,c="OK";t.each(function(e,t){$.each(t.attributes,function(e,t){var r,n;t.name.substr(0,i.length)==i&&("status"==(r=t.name.substring(i.length))?(n=t.value.match(/(\d+)\s?(.*)/),c=null!=n?(s=n[1],n[2]):(s="500","Attribute Error")):o.push(r+": "+t.value))})});var r=0<t.length?t.html():"";return{send:function(e,t){t(s,c,{html:r},o.join("\n"))},abort:function(){}}}),$(function(){init()}),{refresh:refresh,history:_history,triggerRequest:fireICRequest,processNodes:processNodes,closestAttrValue:closestAttrValue,verbFor:verbFor,isDependent:isDependent,getTarget:getTarget,processHeaders:processHeaders,setIsDependentFunction:function(e){_isDependentFunction=e},ready:function(e){_readyHandlers.push(e)},debug:function(){var e=closestAttrValue("body","ic-debugger-url")||"https://intercoolerreleases-leaddynocom.netdna-ssl.com/intercooler-debugger.js";$.getScript(e).fail(function(e,t,r){log($("body"),formatError(r),"ERROR")})},_internal:{init:init,replaceOrAddMethod:replaceOrAddMethod,initEventSource:function(e){return new EventSource(e)}}}}();return Intercooler});